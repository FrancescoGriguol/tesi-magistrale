Calibrating begins...
IMU settings:
  Update rate: 200
  Accelerometer: 
    Noise density: 0.0014
    Noise density (discrete): 0.019799
    Random walk: 8.6e-05
  Gyroscope: 
    Noise density: 8e-05
    Noise density (discrete): 0.00113137
    Random walk: 2.2e-06
Initializing camera:
  Camera model: pinhole
  Focal length: [346 346]
  Principal point: [173 130]
Calibration target:
  Type: APRIL_GRID
  Tags:
    Cols: 6
    Rows: 6
    Size: 0.021 [m]
    PatterSpacing: 0.2857 [m]
    Spacing : 0.0059997 [m]
camTargetObservations size: 1
camId: 0
Calibrating intrinsics using 1758 detections.
Initialization of focal length failed. You can enable manual input by setting 'KALIBR_MANUAL_FOCAL_LENGTH_INIT'.
Initialization of focal length failed
calibrateIntrinsics: intrinsics guess:   346   346 172.5 129.5
calibrateIntrinsics: distortion guess: 0 0 0 0
calibrateIntrinsics: adding camera error terms for 1758 calibration targets
calibrateIntrinsics: added 237703 camera error terms
No linear system solver set in the options. Defaulting to the sparse_cholesky solver
Using the sparse_cholesky linear system solver
Using the levenberg_marquardt trust region policy
calibrateIntrinsics: Before Optimization:  mean: 0.0823789 std: 0.0744495
No linear system solver set in the options. Defaulting to the sparse_cholesky solver
Using the sparse_cholesky linear system solver
Using the levenberg_marquardt trust region policy
Initializing
Optimization problem initialized with 3518 design variables and 237703 error terms
The Jacobian matrix is 475406 x 10556
[0.0]: J: 19581.7
[1]: J: 15482, dJ: 4099.72, deltaX: 0.687202, LM - lambda:10 mu:2
[2]: J: 13769.1, dJ: 1712.86, deltaX: 0.478491, LM - lambda:8.71445 mu:2
[3]: J: 13536.1, dJ: 233.023, deltaX: 2.36414, LM - lambda:2.90482 mu:2
[4]: J: 13479, dJ: 57.1011, deltaX: 10.1896, LM - lambda:0.968273 mu:2
[5]: J: 12898.3, dJ: 580.679, deltaX: 4.22458, LM - lambda:1.42385 mu:2
Last step was a regression. Reverting
[6]: J: 15976.8, dJ: -3078.45, deltaX: 24.1258, LM - lambda:0.474617 mu:2
[7]: J: 12817.2, dJ: 81.1847, deltaX: 2.29156, LM - lambda:1.89847 mu:4
Last step was a regression. Reverting
[8]: J: 13036.3, dJ: -219.163, deltaX: 15.6, LM - lambda:0.632822 mu:2
[9]: J: 12775.2, dJ: 41.9887, deltaX: 1.26451, LM - lambda:2.53129 mu:4
[10]: J: 12589, dJ: 186.135, deltaX: 9.6352, LM - lambda:0.843763 mu:2
[11]: J: 12360.1, dJ: 228.969, deltaX: 8.21365, LM - lambda:0.837575 mu:2
[12]: J: 12172, dJ: 188.104, deltaX: 7.85448, LM - lambda:0.779454 mu:2
[13]: J: 12026.5, dJ: 145.495, deltaX: 7.44713, LM - lambda:0.719013 mu:2
[14]: J: 11918.6, dJ: 107.916, deltaX: 6.84995, LM - lambda:0.664498 mu:2
[15]: J: 11843.8, dJ: 74.7968, deltaX: 6.17481, LM - lambda:0.610972 mu:2
[16]: J: 11795.1, dJ: 48.651, deltaX: 5.34641, LM - lambda:0.564473 mu:2
[17]: J: 11765.9, dJ: 29.1816, deltaX: 4.46073, LM - lambda:0.522768 mu:2
[18]: J: 11749.8, dJ: 16.1285, deltaX: 3.54943, LM - lambda:0.488151 mu:2
[19]: J: 11741.6, dJ: 8.20612, deltaX: 2.69399, LM - lambda:0.460084 mu:2
[20]: J: 11737.7, dJ: 3.87963, deltaX: 1.95236, LM - lambda:0.438263 mu:2
[21]: J: 11736, dJ: 1.72716, deltaX: 1.35854, LM - lambda:0.421565 mu:2
[22]: J: 11735.2, dJ: 0.733487, deltaX: 0.914115, LM - lambda:0.408686 mu:2
calibrateIntrinsics: After Optimization:  mean: 0.0493694 std: 0.0425137
calibrateIntrinsics: optimized intrinsics guess: 431.579 431.861 165.962 125.281
calibrateIntrinsics: optimized distortion guess: -0.0155613 -0.0905872    0.93644   -3.26968
calibrateIntrinsics: initializing calibrator
calibrateIntrinsics: Filtering outliers in all batches
calibrateIntrinsics: All views have been processed. Starting final outlier filtering...
Crazy loop finished.. 

Intrinsics Calibration complete.

Removed 0 outlier corners.
Processed 1758 images with 81 images used
Intrinsic calibration results:
  projection: 427.731 428.004 167.997 126.159 
  distortion: -0.0185369 0.0291111 -0.0893753 -0.3646 
  reprojection error: [-1.03782e-07, -1.2638e-07] +- [0.160313, 0.169172]
  baseline:            1 -1.02276e-12 -7.20729e-13 -3.01501e-13
 1.02276e-12            1 -2.94082e-13  -2.0213e-13
 7.20729e-13  2.94082e-13            1  1.22386e-12
           0            0            0            1

Camera Model: Equidistant Distorted Pinhole
Distortion Model: Equidistant
Finished calibration of intrinsics.
Building the problem...
Calibrating using 1758 detections.
	Spline order: 6
	Pose knots per second: 100
		xddot translation variance: 1e+06
		xddot rotation variance: 100000
	Bias knots per second: 50
	Do bias motion regularization: true
	Blake-Zisserman on reprojection errors -1
	Acceleration Huber width (sigma): -1
	Gyroscope Huber width (sigma): -1
	Do time calibration: true
	Max iterations: 50
	Time offset padding: 0.03
Initializing a pose spline with 7028 knots (100 knots per second over 70.2801 seconds)
  Time shift camera to imu (t_imu = t_cam + shift): 
  -0.00399954

Estimating imu-camera rotation prior

Initializing a pose spline with 7028 knots (100 knots per second over 70.2801 seconds)
Gravity was intialized to  -0.226238   -9.80347 -0.0962036 [m/s^2]
 Transformation prior camera-imu found as: (T_extrinsic)
 -0.999913 0.00629169 -0.0115898          0
0.00664252   0.999513  -0.030485          0
 0.0113924 -0.0305593  -0.999468          0
         0          0          0          1
  Gyro bias prior found as: (b_gyro)
 0.0162523 -0.0175089  0.0272913

Initializing a pose spline with 7040 knots (100 knots per second over 70.4001 seconds)

Initializing the bias splines with 3520 knots

Adding camera error terms (1758) ...
  Added 1758 camera error tems

Adding accelerometer error terms (70309) ...
  Added 70190 of 70309 accelerometer error terms (skipped 119 out-of-bounds measurements)

Adding gyroscope error terms (70309) ...
  Added 70190 of 70309 gyroscope error terms (skipped 119 out-of-bounds measurements)
Calibrating using 1758 target observations and 70309 IMU measurements 
BEFORE OPTIMIZATION

Normalized Residuals
-------------------
Reprojection error:    mean: 382.639 median: 300.099 std: 318.588
Gyroscope error:       mean: 3.74865 median: 2.3443 std: 4.50103
Accelerometer error:   mean: 3.41343 median: 2.43643 std: 3.3869

Residuals
-------------------
Reprojection error [px]:      mean: 17.7448 median: 17.3234 std: 8.23181
Gyroscope error [rad/s]:      mean: 0.0570904 median: 0.0515002 std: 0.0313337
Accelerometer error [m/s^2]:  mean: 0.236329 median: 0.219633 std: 0.10831
Optimizing...

Before Optimization
###################

Normalized Residuals
-------------------
Reprojection error:    mean: 382.639 median: 300.099 std: 318.588
Gyroscope error:       mean: 3.74865 median: 2.3443 std: 4.50103
Accelerometer error:   mean: 3.41343 median: 2.43643 std: 3.3869

Residuals
-------------------
Reprojection error [px]:      mean: 17.7448 median: 17.3234 std: 8.23181
Gyroscope error [rad/s]:      mean: 0.0570904 median: 0.0515002 std: 0.0313337
Accelerometer error [m/s^2]:  mean: 0.236329 median: 0.219633 std: 0.10831

Optimizing...
Using the block_cholesky linear system solver
Using the levenberg_marquardt trust region policy
Using the block_cholesky linear system solver
Using the levenberg_marquardt trust region policy
Initializing
Optimization problem initialized with 14099 design variables and 378085 error terms
The Jacobian matrix is 896548 x 63429
[0.0]: J: 9.14571e+07
[1]: J: 1.64666e+06, dJ: 8.98105e+07, deltaX: 0.101824, LM - lambda:10 mu:2
[2]: J: 31250, dJ: 1.61541e+06, deltaX: 0.109928, LM - lambda:3.33333 mu:2
[3]: J: 20718.4, dJ: 10531.6, deltaX: 0.212952, LM - lambda:1.11111 mu:2
[4]: J: 19935.7, dJ: 782.636, deltaX: 0.0570559, LM - lambda:0.37037 mu:2
[5]: J: 19934.5, dJ: 1.23078, deltaX: 0.00542118, LM - lambda:0.123457 mu:2
Last step was a regression. Reverting
[6]: J: 19934.5, dJ: -0.000318532, deltaX: 0.0486719, LM - lambda:0.0411523 mu:2

After Optimization
###################

Normalized Residuals
-------------------
Reprojection error:    mean: 0.0509631 median: 0.0401108 std: 0.043624
Gyroscope error:       mean: 0.00861306 median: 0.00645829 std: 0.00789376
Accelerometer error:   mean: 0.102771 median: 0.0731651 std: 0.107345

Residuals
-------------------
Reprojection error [px]:      mean: 0.203024 median: 0.200277 std: 0.0987135
Gyroscope error [rad/s]:      mean: 0.00284572 median: 0.0027031 std: 0.00128314
Accelerometer error [m/s^2]:  mean: 0.0407019 median: 0.0380604 std: 0.0194452

Results
#######

Optimization converged:
  true
Transformation T_cam_imu:
  -0.999966   9.463e-05 -0.00821939  -0.0021056
7.50614e-05    0.999997  0.00238107 -0.00548146
  0.0082196  0.00238037   -0.999963  -0.0658417
          0           0           0           1
Camera to imu time: [s] (t_imu = t_cam + shift):
  0.00765382
AFTER OPTIMIZATION

Normalized Residuals
-------------------
Reprojection error:    mean: 0.0509631 median: 0.0401108 std: 0.043624
Gyroscope error:       mean: 0.00861306 median: 0.00645829 std: 0.00789376
Accelerometer error:   mean: 0.102771 median: 0.0731651 std: 0.107345

Residuals
-------------------
Reprojection error [px]:      mean: 0.203024 median: 0.200277 std: 0.0987135
Gyroscope error [rad/s]:      mean: 0.00284572 median: 0.0027031 std: 0.00128314
Accelerometer error [m/s^2]:  mean: 0.0407019 median: 0.0380604 std: 0.0194452
RESULT
Optimization converged:
  true
Transformation T_cam_imu:
  -0.999966   9.463e-05 -0.00821939  -0.0021056
7.50614e-05    0.999997  0.00238107 -0.00548146
  0.0082196  0.00238037   -0.999963  -0.0658417
          0           0           0           1
Camera to imu time: [s] (t_imu = t_cam + shift):
  0.00765382
